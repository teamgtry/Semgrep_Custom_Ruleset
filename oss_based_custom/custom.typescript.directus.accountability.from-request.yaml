rules:
  - id: custom.typescript.directus.accountability.from-request
    languages: [typescript]
    severity: ERROR
    message: >
      [Custom Rule] Directus TUS 업로드 처리 과정에서
      req.accountability가 그대로 사용되고 있습니다.
      요청 객체에서 파생된 accountability는 신뢰할 수 없으며,
      권한 우회 또는 파일 접근 통제 실패로 이어질 수 있습니다.
      context.accountability ?? null을 사용하지 않을 경우
      실제 권한 검증 우회가 발생할 수 있는 고위험 패턴입니다.
    metadata:
      category: security
      product: directus
      area: files-upload-tus
      cwe:
        - "CWE-285: Improper Authorization"
        - "CWE-639: Authorization Bypass Through User-Controlled Key"
    paths:
      include:
        - api/src/services/tus/server.ts
    pattern-regex: 'accountability\s*:\s*req\.accountability'
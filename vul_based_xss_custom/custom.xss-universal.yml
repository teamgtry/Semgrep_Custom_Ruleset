rules:
- id: custom.xss.js.taint.to-html-parsing-sinks
  message: '[Custom Rule] Possible DOM XSS: untrusted data flows into HTML parsing sinks (innerHTML/outerHTML/insertAdjacentHTML/document.write).'
  severity: WARNING
  languages:
  - javascript
  - typescript
  mode: taint
  pattern-sources:
  - pattern-either:
    - pattern: $X.innerText
    - pattern: $X.textContent
    - pattern: $X.value
    - pattern: $X.val()
    - pattern: window.location.hash
    - pattern: window.location.search
    - pattern: document.location.hash
    - pattern: document.location.search
    - pattern: localStorage.getItem($K)
    - pattern: sessionStorage.getItem($K)
  pattern-sinks:
  - pattern-either:
    - pattern: $EL.innerHTML = $V
    - pattern: $EL.innerHTML += $V
    - pattern: $EL.outerHTML = $V
    - pattern: $EL.insertAdjacentHTML($POS, $V)
    - pattern: document.write($V)
  pattern-sanitizers:
  - pattern-either:
    - pattern: $EL.textContent = $V
    - pattern: $EL.innerText = $V
    - pattern: DOMPurify.sanitize($V)
  metadata:
    category: security
    cwe: CWE-79
    confidence: medium
- id: custom.xss.php.taint.to-echo-print
  message: '[Custom Rule] Possible XSS (PHP): request/tainted input flows into echo/print/printf/die/exit
    without output escaping.'
  severity: WARNING
  languages:
  - php
  mode: taint
  pattern-sources:
  - pattern-either:
    - pattern: $_GET[$K]
    - pattern: $_POST[$K]
    - pattern: $_REQUEST[$K]
    - pattern: $_COOKIE[$K]
    - pattern: $_SERVER[$K]
  pattern-sinks:
  - pattern-either:
    - pattern: echo $X;
    - pattern: print $X;
    - pattern: printf($FMT, $X, ...);
    - pattern: die($X);
    - pattern: exit($X);
  pattern-sanitizers:
  - pattern-either:
    - pattern: htmlspecialchars($X, ...)
    - pattern: htmlentities($X, ...)
    - pattern: strip_tags($X)
  metadata:
    category: security
    cwe: CWE-79
    confidence: medium
- id: custom.xss.python.taint.to-django-httpresponse
  message: '[Custom Rule] Possible XSS (Django): untrusted input flows into HttpResponse/JsonResponse
    without explicit escaping.'
  severity: WARNING
  languages:
  - python
  mode: taint
  pattern-sources:
  - pattern-either:
    - pattern: request.GET.get($K, ...)
    - pattern: request.POST.get($K, ...)
    - pattern: request.GET[$K]
    - pattern: request.POST[$K]
    - pattern: request.headers.get($K, ...)
  pattern-sinks:
  - pattern-either:
    - pattern: HttpResponse($X, ...)
    - pattern: JsonResponse($X, ...)
  pattern-sanitizers:
  - pattern-either:
    - pattern: django.utils.html.escape($X)
    - pattern: format_html($X, ...)
  metadata:
    category: security
    cwe: CWE-79
    confidence: low
- id: custom.xss.python.taint.to-flask-response
  message: '[Custom Rule] Possible XSS (Flask): untrusted input flows into Response/make_response
    without explicit escaping.'
  severity: WARNING
  languages:
  - python
  mode: taint
  pattern-sources:
  - pattern-either:
    - pattern: request.args.get($K, ...)
    - pattern: request.form.get($K, ...)
    - pattern: request.values.get($K, ...)
    - pattern: request.headers.get($K, ...)
    - pattern: request.get_json(...)
  pattern-sinks:
  - pattern-either:
    - pattern: Response($X, ...)
    - pattern: make_response($X, ...)
  pattern-sanitizers:
  - pattern-either:
    - pattern: markupsafe.escape($X)
  metadata:
    category: security
    cwe: CWE-79
    confidence: low
- id: custom.xss.ruby.taint.to-render-raw-html
  message: '[Custom Rule] Possible XSS (Rails): tainted input flows into raw HTML rendering (render
    html/inline/raw/html_safe).'
  severity: WARNING
  languages:
  - ruby
  mode: taint
  pattern-sources:
  - pattern-either:
    - pattern: params[$K]
    - pattern: params.fetch($K, ...)
  pattern-sinks:
  - pattern-either:
    - pattern: 'render html: $X'
    - pattern: 'render inline: $X'
    - pattern: raw($X)
    - pattern: $X.html_safe
  pattern-sanitizers:
  - pattern-either:
    - pattern: ERB::Util.html_escape($X)
    - pattern: CGI.escapeHTML($X)
    - pattern: sanitize($X)
  metadata:
    category: security
    cwe: CWE-79
    confidence: low
- id: custom.xss.pack.express.taint.to-response
  message: '[Custom Rule] Possible XSS (Express): request data flows into response output. Ensure
    correct escaping/sanitization.'
  severity: WARNING
  languages:
  - javascript
  - typescript
  mode: taint
  pattern-sources:
  - pattern-either:
    - pattern: $REQ.query
    - pattern: $REQ.params
    - pattern: $REQ.body
    - pattern: $REQ.headers
    - pattern: $REQ.cookies
    - pattern: $REQ.query[$K]
    - pattern: $REQ.params[$K]
    - pattern: $REQ.body[$K]
    - pattern: $REQ.headers[$K]
  pattern-sinks:
  - pattern-either:
    - pattern: $RES.send($X)
    - pattern: $RES.end($X)
    - pattern: $RES.write($X)
    - pattern: $RES.json($X)
  pattern-sanitizers:
  - pattern-either:
    - pattern: escape($X)
    - pattern: encodeURIComponent($X)
    - pattern: he.encode($X)
    - pattern: xss($X)
    - pattern: DOMPurify.sanitize($X)
  metadata:
    category: security
    cwe: CWE-79
    confidence: low
- id: custom.xss.pack.springmvc.taint.to-model-or-response
  message: '[Custom Rule] Possible XSS (Spring MVC): untrusted request input flows into model or
    response output without context-appropriate encoding.'
  severity: WARNING
  languages:
  - java
  mode: taint
  pattern-sources:
  - pattern-either:
    - pattern: $REQ.getParameter($K)
    - pattern: $REQ.getHeader($K)
  pattern-sinks:
  - pattern-either:
    - pattern: $MODEL.addAttribute($NAME, $X)
    - pattern: $MAP.put($NAME, $X)
    - pattern: $RESP.getWriter().write($X)
  pattern-sanitizers:
  - pattern-either:
    - pattern: org.springframework.web.util.HtmlUtils.htmlEscape($X)
    - pattern: org.apache.commons.text.StringEscapeUtils.escapeHtml4($X)
  metadata:
    category: security
    cwe: CWE-79
    confidence: low
- id: custom.xss.pack.wordpress.taint.to-echo-without-esc
  message: '[Custom Rule] Possible XSS (WordPress): request input flows into output without WordPress
    escaping helpers.'
  severity: WARNING
  languages:
  - php
  mode: taint
  pattern-sources:
  - pattern-either:
    - pattern: $_GET[$K]
    - pattern: $_POST[$K]
    - pattern: $_REQUEST[$K]
  pattern-sinks:
  - pattern-either:
    - pattern: echo $X;
    - pattern: print $X;
    - pattern: printf($FMT, $X, ...);
  pattern-sanitizers:
  - pattern-either:
    - pattern: esc_html($X)
    - pattern: esc_attr($X)
    - pattern: esc_url($X)
    - pattern: esc_js($X)
    - pattern: wp_kses($X, ...)
    - pattern: wp_kses_post($X)
    - pattern: sanitize_text_field($X)
  metadata:
    category: security
    cwe: CWE-79
    confidence: low
- id: custom.xss.java.response-writer-write-untrusted
  message: '[Custom Rule] Possible XSS: untrusted input written to HTTP response. Ensure correct
    output encoding for the context (HTML/attr/JS/URL).'
  severity: WARNING
  languages:
  - java
  mode: taint
  pattern-sources:
  - pattern-either:
    - pattern: $REQ.getParameter($K)
    - pattern: $REQ.getHeader($K)
    - pattern: $REQ.getQueryString()
  pattern-sinks:
  - pattern-either:
    - pattern: $RESP.getWriter().write($X)
    - pattern: $RESP.getWriter().print($X)
    - pattern: $RESP.getWriter().println($X)
  pattern-sanitizers:
  - pattern-either:
    - pattern: org.apache.commons.text.StringEscapeUtils.escapeHtml4($X)
    - pattern: org.springframework.web.util.HtmlUtils.htmlEscape($X)
  metadata:
    category: security
    cwe: CWE-79
    confidence: medium
- id: custom.xss.js.dom-attr-injection.template-to-innerhtml
  message: '[Custom Rule] Likely DOM XSS: DOM text (innerText/textContent) interpolated into an
    HTML attribute inside a template literal assigned to innerHTML/insertAdjacentHTML.'
  severity: ERROR
  languages:
  - javascript
  - typescript
  patterns:
  - pattern-either:
    - pattern: $EL.innerHTML = `$HTML`
    - pattern: $EL.innerHTML += `$HTML`
    - pattern: $EL.insertAdjacentHTML($POS, `$HTML`)
  - metavariable-pattern:
      metavariable: $HTML
      patterns:
      - pattern-regex: =\s*"\s*\$\{[^}]*\.(innerText|textContent)[^}]*\}\s*"
  metadata:
    category: security
    cwe: CWE-79
    confidence: high
- id: custom.xss.js.dynamic-code-exec
  message: >
    [Custom Rule] High-risk dynamic code execution (eval/Function/setTimeout-string). If attacker-controlled, this is XSS/JS injection.
  severity: ERROR
  languages:
  - javascript
  - typescript
  pattern-either:
  - pattern: eval($X)
  - pattern: window.eval($X)
  - pattern: (0, eval)($X)
  - pattern: new Function($X)
  - pattern: Function($X)
  - pattern: setTimeout($X, ...)
  - pattern: setInterval($X, ...)
  metadata:
    category: security
    cwe: CWE-95
    confidence: high
- id: custom.xss.js.regex-strip-script-tag
  message: >
    [Custom Rule] Regex-based <script> stripping is unsafe and bypassable (XSS may remain or be reconstructed). Prefer parser-based sanitization.
  severity: WARNING
  languages:
  - javascript
  - typescript
  patterns:
  - pattern-either:
    - pattern: $S.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/g, "")
    - pattern: $S.replace(/<script.*?>.*?<\/script>/g, "")
  metadata:
    category: security
    cwe: CWE-79
    confidence: medium
- id: custom.xss.php.dynamic-code-exec
  message: >
    [Custom Rule] High-risk dynamic code execution in PHP (eval/assert). If attacker-controlled, this is code injection and often leads to XSS/compromise.
  severity: ERROR
  languages:
  - php
  pattern-either:
  - pattern: eval($X);
  - pattern: assert($X);
  metadata:
    category: security
    cwe: CWE-95
    confidence: high
- id: custom.xss.python.flask-render-template-string
  message: '[Custom Rule] High-risk: render_template_string renders attacker-controlled templates/HTML.
    Avoid with untrusted input.'
  severity: ERROR
  languages:
  - python
  pattern: render_template_string($X, ...)
  metadata:
    category: security
    cwe: CWE-79
    confidence: high
- id: custom.xss.python.jinja2-from-string-render
  message: '[Custom Rule] High-risk: Jinja2 template from untrusted string rendered. Can lead to
    XSS (and depending on usage, SSTI).'
  severity: ERROR
  languages:
  - python
  patterns:
  - pattern: $ENV.from_string($X).render(...)
  metadata:
    category: security
    cwe: CWE-79
    confidence: medium
- id: custom.xss.ruby.rails-html-safe
  message: '[Custom Rule] Potential XSS: html_safe disables escaping. Ensure content is trusted
    or sanitized.'
  severity: WARNING
  languages:
  - ruby
  pattern: $X.html_safe
  metadata:
    category: security
    cwe: CWE-79
    confidence: high
- id: custom.xss.ruby.rails-raw
  message: '[Custom Rule] Potential XSS: raw() outputs unescaped HTML.'
  severity: WARNING
  languages:
  - ruby
  pattern: raw($X)
  metadata:
    category: security
    cwe: CWE-79
    confidence: high
- id: custom.xss.ruby.rails-render-inline
  message: '[Custom Rule] High-risk: render inline can render attacker-controlled templates/HTML.'
  severity: ERROR
  languages:
  - ruby
  pattern: 'render inline: $X'
  metadata:
    category: security
    cwe: CWE-79
    confidence: high

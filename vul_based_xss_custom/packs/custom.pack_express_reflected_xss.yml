rules:
  - id: custom.xss.pack.express.taint.to-response
    message: "[Custom Rule] Possible XSS (Express): request data flows into response output. Ensure correct escaping/sanitization."
    severity: WARNING
    languages: [javascript, typescript]
    mode: taint
    pattern-sources:
      - pattern-either:
          - pattern: $REQ.query
          - pattern: $REQ.params
          - pattern: $REQ.body
          - pattern: $REQ.headers
          - pattern: $REQ.cookies
          - pattern: $REQ.query[$K]
          - pattern: $REQ.params[$K]
          - pattern: $REQ.body[$K]
          - pattern: $REQ.headers[$K]
    pattern-sinks:
      - pattern-either:
          - pattern: $RES.send($X)
          - pattern: $RES.end($X)
          - pattern: $RES.write($X)
          - pattern: $RES.json($X)
    pattern-sanitizers:
      - pattern-either:
          - pattern: escape($X)
          - pattern: encodeURIComponent($X)
          - pattern: he.encode($X)
          - pattern: xss($X)
          - pattern: DOMPurify.sanitize($X)
    metadata:
      category: security
      cwe: "CWE-79"
      confidence: low
